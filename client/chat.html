<!DOCTYPE html>
<html>
<head>
  <title>Chat Room</title>
  <script src="https://js.pusher.com/8.2/pusher.min.js"></script>
  <style>
    body { font-family: Arial; background: #f2f2f2; }
    #chatBox { max-width: 600px; margin: 50px auto; background: #fff; padding: 20px; border-radius: 10px; }
    #messages { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
    .msg { margin: 5px 0; }
    .me { text-align: right; color: green; }
    .them { text-align: left; color: blue; }
  </style>
</head>
<body>

<div id="chatBox">
  <h2>ðŸ’¬ Chat with your match</h2>
  <div id="messages"></div>
  <input type="text" id="msgInput" placeholder="Type a message..." />
  <button onclick="sendMessage()">Send</button>
</div>

<script>
  const yourName = localStorage.getItem("yourName");
  const matchedName = localStorage.getItem("matchedName");

  const channelName = [yourName, matchedName].sort().join("_");

  // Connect to Pusher
  const pusher = new Pusher('YOUR_PUSHER_KEY', {
    cluster: 'YOUR_CLUSTER',
    encrypted: true
  });

  const channel = pusher.subscribe(channelName);

  channel.bind('new_message', function(data) {
    const isMine = data.sender === yourName;
    const msgDiv = document.createElement("div");
    msgDiv.className = "msg " + (isMine ? "me" : "them");
    msgDiv.innerText = `${data.sender}: ${data.message}`;
    document.getElementById("messages").appendChild(msgDiv);
  });

  function sendMessage() {
    const message = document.getElementById("msgInput").value;
    if (!message) return;

    fetch("https://instant-match.onrender.com/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        sender: yourName,
        receiver: matchedName,
        message
      })
    });

    document.getElementById("msgInput").value = "";
  }
</script>
<script src="https://js.pusher.com/7.2/pusher.min.js"></script>

</body>
</html>
